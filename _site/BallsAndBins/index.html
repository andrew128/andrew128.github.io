<!DOCTYPE html>
<html>
  <head>
    <title>Balls and Bins Proof – Andrew Wei – </title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="A full walk through of the balls and bins proof, split up into 4 parts.
" />
    <meta property="og:description" content="A full walk through of the balls and bins proof, split up into 4 parts.
" />
    
    <meta name="author" content="Andrew Wei" />

    
    <meta property="og:title" content="Balls and Bins Proof" />
    <meta property="twitter:title" content="Balls and Bins Proof" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Andrew Wei - " href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://avatars0.githubusercontent.com/u/8172167?s=400&u=27034bc93779390bfbaca21727973a54058fc093&v=4" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Andrew Wei</a></h1>
            <p class="site-description"></p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  tex2jax: {
  inlineMath: [['$','$'], ['\\(','\\)']],
  processEscapes: true},
  jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
  extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],
  TeX: {
  extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
  equationNumbers: {
  autoNumber: "AMS"
  }
  }
  });
  </script>
<article class="post">
  <h1>Balls and Bins Proof</h1>

  <div class="date">
    Written on September 28, 2020
  </div>
  <div class="entry">
    <p>A full walk through of the balls and bins proof, split up into 4 parts.</p>

<h2 id="post-outline">Post Outline</h2>
<ul>
  <li><a href="#intro">Intro</a></li>
  <li><a href="#part-1">Part 1: Upper Bound of &gt; k balls in a given bin</a></li>
  <li><a href="#part-2">Part 2: Upper Bound of &gt; k balls in any bin</a></li>
  <li><a href="#part-3">Part 3: Finding the right k</a></li>
  <li><a href="#part-4">Part 4: Conclusion</a></li>
  <li><a href="#resources">Resources</a></li>
</ul>

<h2 id="intro">Intro</h2>
<p>In the balls and bins problem, we want to show that if $n$ balls are throw independently and uniformly into $n$ bins, the max bin size will be $O(\frac{\log n}{\log \log n})$ with high probability (specifically $1 - \frac{1}{n}$).
An example of where this can be applied is in hash tables, where we assume that we want to store $n$ values inside a hash table of size $n$.
We can then say with high probability that the longest get or put operation will be on the order of $O(\frac{\log n}{\log \log n})$.</p>

<h2 id="part-1">Part 1</h2>

<p>Let’s start by coming up with an expression for the probability that a given bin out of the $n$ total bins contains exactly $k$ balls of the $n$ total balls.
We will use the notation $X_{=k}$ to denote this event.
The probability that a given ball lands in a given bin is then $\frac{1}{n}$.
This is because we assume the balls are distributed uniformly.
For a given subset of the $n$ total balls of size $k$, the probability that all of those balls in that specific subset land in a given bin is then $\frac{1}{n^k}$.
The total number of subsets of size $k$ from a total set of size $n$ is ${n \choose k}$.
Therefore, our total probability that there are a subset of $k$ balls in a particular bin is:
\({n \choose k} \frac{1}{n^k}\)</p>

<p>However, we want exactly $k$ balls, which means we also need to factor in the probability that the rest of the balls do not make it into the particular bin.
We can apply the reverse logic.
The probability that a given ball does not fall into a given bin is $1 - \frac{1}{n}$.
We have $n - k$ balls left after our original $k$ balls have already made it into the bin.
Then, the probability that the rest of the $n - k$ balls do not make it into the bin is:</p>

\[(1 - \frac{1}{n})^{n - k}\]

<p>We can combine our previous 2 expressions to get the expression for the probability that exactly $k$ balls land in a given bin.</p>

\[P(X_{=k}) = {n \choose k} \frac{1}{n^k}(1 - \frac{1}{n})^{n - k}\]

<p>If we think about it, the expression ${n \choose k} \frac{1}{n^k}$ is actually an upper bound on the probability that there are more than $k$ balls that fall into a given bin, denoted by $P(X_{&gt; k})$.
The term only includes the probability that a given $k$ balls will fall into the bin and does not say anything about the remaining balls.
The only difference between the below expression for $P(X_{&gt; k})$ and the above expression for $P(X_{= k})$ is the $(1 - \frac{1}{n})^{n - k}$.
This term $(1 - \frac{1}{n})^{n - k}$ represents the added restriction that none of the other $n - k$ balls can fall into the bin.
Removing it means the other $n - k$ balls may or may not fall into the bin.
If we were to add any more restrictions that more than $k$ would have to be in the bin, we would be adding terms that are smaller than $1$ because they are probabilities, and make the resulting expression less than the below expression.</p>

<p>As a side note, we could have just presented the expression below without first deriving the expression for $P(X_{=k})$ but I think the expression for $P(X_{=k})$ helps to add context.</p>

\[P(X_{&gt; k}) \leq {n \choose k} \frac{1}{n^k}\]

<h2 id="part-2">Part 2</h2>

<p>We will now expand the combination term out of the above expression.</p>

\[P(X_{&gt; k}) \leq {n \choose k} \frac{1}{n^k}\]

\[\leq \frac{(n)(n-1)...(n-k+1)}{k!}\frac{1}{n^k}\]

\[\leq \frac{(n)(n-1)...(n-k+1)}{k(k-1)...(1)}\frac{1}{n^k}\]

\[\leq (\frac{n}{k})^k\frac{1}{n^k}\]

\[\leq (\frac{n}{k})^k\frac{1}{k!}\]

\[\leq \frac{1}{k!}\]

<p>Using union bound (aka summing across all the different possible bins), we have that for any bin, the probability that the number of balls is bigger than $k$ is (a stands for any):</p>

\[P(X_{a, &gt; k}) \leq \frac{n}{k!}\]

<h2 id="part-3">Part 3</h2>

<p>To prove our high probability bound of $1 - \frac{1}{n}$, we want to choose a value for $k$ such that $\frac{n}{k!} \approx \frac{1}{n}$.
Let’s first rearrange the expression and then take the log of both sides:</p>

\[\frac{n}{k!} \approx \frac{1}{n}\]

\[n^2 \approx k!\]

\[\ln(k!) \approx 2\ln(n)\]

\[\ln(k!) \approx \ln(n)\]

<p>We will now use Stirling’s approximation for factorials for the left side of the expression:
\(\ln(k!) = k\ln k - k \approx \ln(n)\)</p>

\[k(\ln k - 1) \approx \ln(n)\]

\[k \approx \frac{\ln(n)}{\ln k - 1}\]

\[\approx \frac{\ln(n)}{\ln k - 1}\]

<p>So because $k \approx \frac{\ln(n)}{\ln k - 1}$, we can sub it back into the above expression and get:</p>

\[\approx \frac{\ln(n)}{\ln \frac{\ln(n)}{\ln k - 1} - 1}\]

\[\approx \frac{\ln(n)}{\ln \ln n - \ln\ln (k - 1) - 1}\]

<p>As $n$ gets large, we can disregard the constants and the expressions with $k$ to get:</p>

\[k \approx \frac{\ln(n)}{\ln \ln n}\]

<h2 id="part-4">Part 4</h2>

<p>We can now rewrite the below expression using our newly found approximation of $k$ such that $\frac{n}{k!} \approx \frac{1}{n}$ for any bucket.</p>

\[P(X_{a, &gt; k}) \leq \frac{n}{k!}\]

\[P(X_a &gt; \frac{\ln(n)}{\ln \ln n}) &lt; \frac{1}{n}\]

<p>The above expression can be interpreted as: the probability that any bucket has more than $\frac{\ln(n)}{\ln \ln n}$ balls is less than $\frac{1}{n}$.
In other words, we will have at most $\frac{\ln(n)}{\ln \ln n}$ balls max in any bucket with probability $1 - \frac{1}{n}$.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="http://www.cs.toronto.edu/~toni/Courses/263-2013/handouts/hashing-uiuc.pdf">Toronto</a></li>
  <li><a href="https://www.cs.purdue.edu/homes/hmaji/teaching/Spring%202017/lectures/03.pdf">Purdue</a></li>
  <li><a href="https://www.cs.princeton.edu/courses/archive/fall16/cos521/Lectures/lec1.pdf">Princeton</a></li>
</ul>

  </div>


  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          



<a href="https://github.com/andrew128"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/andrew-wei-272027147/"><i class="svg-icon linkedin"></i></a>






        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-177211139-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/BallsAndBins/',
		  'title': 'Balls and Bins Proof'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
